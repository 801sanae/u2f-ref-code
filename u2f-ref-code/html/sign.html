<html>
	<body>
		<h1>Sign</h1>
		
		<script src="/fido-u2f.js"></script>
		<script src="/signData.js?userName=userName"></script>
		
		<div id="status">Waiting for user touch</div>
		
		<script>
			// Constants
			var extensionId = "dlfcjilkjfhdnfiecknlnddkmmiofjbg";
			
			var u2f = new FidoU2f(extensionId);
			
		    function callback(result) {
		      if (result.errorCode) {
		        document.getElementById('status')
		        	.innerHTML = "Failed. Error code: " + result.errorCode;
		        return;
		      }
		      
		      location = "/signFinish"
		            + "?browserData=" + result.browserData
		            + "&appId=" + result.appId
		            + "&challenge=" + result.challenge
		            + "&signData=" + result.signData
		            + "&sessionId=" + result.sessionId;
		    }
			
			if ((typeof signData) == "undefined") {
			  var statusDiv = document.getElementById('status');
			  statusDiv.innerText = "No security keys registered";
			} else {
			  u2f.sign(signData, callback);
			}
		</script>
	</body>
</html>